/* ---------------------------------------------------------------------------------------
  WinX68k Compact
  SHARP X68000 emulator ソースコードドキュメント
                                                            (c) 2024- Kengo Takagi (Kenjo)
--------------------------------------------------------------------------------------- */

1. はじめに

　このプログラムは、拙作「WinX68k（けろぴー）」をベースに全般的に再コーディングしたもので
す。

  - サポートしている機能自体は旧 WinX68k に比べて縮小気味です（ゆえに「Compact」）
  - X68000 エミュレーションコア部分は、アセンブラコードなどの機種依存性は極力排除し移植し
    やすさを意識した構造となっています。結果として処理速度はそんなに高くないです
  - 描画のエミュレーション精度などは旧 WinX68k よりマシだと思います。が特段高いわけでもな
    いので、こだわりたい方は PI. 氏、および GIMONS 氏作成の「XM6 TypeG」の利用をお勧めしま
    す



2. コンパイル方法

  - win32/winx68kc.sln コンパイルしてください。Visual Studio 2017 のプロジェクトになります。
  - DirectX SDKがインストールされている必要があります。手元では Feb.2010 で動作確認してい
    ます。



3. ソース構成について

  /
  |--- device/  fmgen/MUSASHI などの、このプロジェクト外開発のコードです
  |--- system/  エミュレーションコア用の汎用基幹システムです
  |--- win32/   Windows用の上位層（UI層）コードです
  |--- x68000/  X68000エミュレータのコアコードです



4. Windows以外の環境での動かし方

  基本的には win32/src/win32core.cpp の実装を参考にしてください。
  win32/ 以外のコードを実行プロジェクトに取り込んだのち、以下の手順で動作されることができます。

  1. system/include/osconfig.h を環境に合わせて編集

  2. エミュレーションコアの初期化

      #include "x68000_driver.h"
      EMUDRIVER* pDrv = X68kDriver_Initialize(IPL_ROM, FONT_ROM, SOUND_HZ);

      pDrv はエミュレーションコア構造体へのポインタです。
      以降、このポインタを引数にしてコアを呼び出します。

      IPL_ROM, FONT_ROM はそれぞれ IPL と FONT データへのポインタです。
      エミュコアは内部でコピーを保持するため、初期化が終了した時点で破棄してかまいません。

      SOUND_HZ はエミュが生成するサウンドデータのサンプリング周波数です。

  3. エミュレーションコアの実行

      X68kDriver_Exec(pDrv, PERIOD);

      PERIOD は実行時間です。
      例えば 60fps 環境下で1フレーム分実行する場合は 1/60 を指定します。

      上記の実行が終わった時点で、pDrv->scr に1フレーム分の画像が、pDrv->sound に同じくサウン
      ドデータが生成されています。
      実行環境に合わせて適宜出力してください。

  4. エミュレーションコアの終了

      X68kDriver_Cleanup(pDrv);

      メモリなどの開放を行い終了します。

  5. その他の操作

      動作の変更や入力を渡しなどは、基本的に全て X68kDriver_XXX() を通して行います。
      x68000_driver.h などをご確認ください。
